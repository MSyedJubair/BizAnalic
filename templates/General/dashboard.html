<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bank Analytics Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      :root {
        --bg: #0b1528;
        --bg-light: #101c36;
        --accent: #2dd4bf;
        --text: #e2e8f0;
        --muted: #94a3b8;
        --card: #1e293b;
      }
      [data-theme="light"] {
        --bg: #f8fafc;
        --bg-light: #ffffff;
        --accent: #2563eb;
        --text: #0f172a;
        --muted: #475569;
        --card: #f1f5f9;
      }

      body {
        margin: 0;
        font-family: "Montserrat", sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        flex-direction: row;
        height: 100vh;
        overflow: hidden;
      }

      /* Sidebar */
      .sidebar {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        width: 240px;
        background: var(--bg-light);
        display: flex;
        flex-direction: column;
        gap: 40px;
        padding: 20px;
      }
      .logo {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        font-weight: 700;
        color: var(--accent);
        text-align: center;
      }
      .nav-links a {
        display: block;
        padding: 12px 16px;
        margin-bottom: 10px;
        color: var(--text);
        font-size: 2rem;
        text-decoration: none;
        border-radius: 8px;
        transition: background 0.3s;
      }
      .nav-links a:hover {
        background: rgba(255, 255, 255, 0.08);
      }
      .upload-btn {
        margin-top: auto;
        padding: 12px 35px;
        background: var(--accent);
        border: none;
        border-radius: 8px;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
      }
      .upload-btn:hover {
        transform: scale(1.05);
      }

      /* Main */
      .main {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
      }

      .toggle {
        align-self: flex-end;
        margin-bottom: 10px;
        cursor: pointer;
        background: var(--card);
        border: none;
        color: var(--text);
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 14px;
      }

      .cards {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
      }
      .card {
        flex: 1 1 330px;
        height: 150px;
        background: var(--card);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s;
      }
      .card:hover {
        transform: translateY(-4px);
      }
      .card h3 {
        margin: 0;
        font-size: 16px;
        color: var(--muted);
      }
      .card p {
        margin: 8px 0 0;
        font-size: 20px;
        font-weight: 700;
      }

      .charts {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }
      .chart-container {
        flex: 1 1 330px;
        max-width: 350px;
        background: var(--card);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s;
      }
      .chart-container:hover {
        transform: translateY(-4px);
      }
      canvas {
        width: 100% !important;
        height: 260px !important;
      }

      /* Hamburger (hidden on desktop) */
      .hamburger {
        display: flex;
        position: fixed;
        background-color: var(--bg-light);
        top: 15px;
        left: 15px;
        border: none;
        font-size: 24px;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 6px;
        z-index: 1001;
      }

      /* Sidebar sliding for mobile */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          top: 0;
          left: -250px; /* hidden by default */
          height: 100vh;
          width: 240px;
          background: var(--bg-light);
          transition: left 0.3s ease;
          z-index: 1000;
        }

        .sidebar.active {
          left: 0; /* slide in */
        }

        .hamburger {
          display: block;
        }

        .main {
          margin-left: 0;
          padding: 20px;
          flex: 1;
        }

        .cards,
        .charts {
          flex-direction: column;
          align-items: center;
        }

        .card,
        .chart-container {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="logo">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 200 200"
          width="100"
          height="100"
        >
          <defs>
            <linearGradient
              id="electricGradient"
              x1="0%"
              y1="0%"
              x2="100%"
              y2="100%"
            >
              <stop offset="0%" stop-color="#00f0ff" />
              <stop offset="100%" stop-color="#0066ff" />
            </linearGradient>
          </defs>

          <!-- Hexagon wave -->
          <g transform="translate(100,100)">
            <polygon
              points="10,0 5,8.66 -5,8.66 -10,0 -5,-8.66 5,-8.66"
              fill="#00aaff"
              opacity="0.7"
            />
            <polygon
              points="20,0 15,8.66 5,8.66 0,0 5,-8.66 15,-8.66"
              fill="#00ccff"
              opacity="0.6"
            />
            <polygon
              points="30,0 25,8.66 15,8.66 10,0 15,-8.66 25,-8.66"
              fill="#0099ff"
              opacity="0.5"
            />
            <polygon
              points="40,0 35,8.66 25,8.66 20,0 25,-8.66 35,-8.66"
              fill="#00e6ff"
              opacity="0.4"
            />
          </g>

          <!-- Electric line -->
          <path
            d="M60,140 C80,60 140,140 160,60"
            stroke="url(#electricGradient)"
            stroke-width="3"
            fill="none"
            stroke-linecap="round"
          />
        </svg>
        <div>BIZANALIC</div>
      </div>
      <div class="nav-links">
        <a href="/dashboard">Dashboard</a>
      </div>
      <form
        method="post"
        enctype="multipart/form-data"
        id="uploadForm"
        action="/uploadfile"
      >
        {% csrf_token %}
        <input
          type="file"
          name="statement"
          accept=".csv,.xlsx,.xls,.pdf"
          style="display: none"
          id="fileInput"
        />
        <label for="fileInput" class="upload-btn">Upload</label>
      </form>
    </div>

    <div class="main">
      <button class="hamburger" id="hamburger">â˜°</button>
      <button class="toggle" onclick="toggleTheme()">Toggle Theme</button>

      <div class="cards">
        <div class="card">
          <h3>Total Income</h3>
          <p>
            {% if total_income %} {{ total_income }} {% else %} ... {% endif %}
          </p>
        </div>

        <div class="card">
          <h3>Total Expenses</h3>
          <p>
            {% if total_expense %} {{ total_expense }} {% else %} ... {% endif %}
          </p>
        </div>

        <div class="card">
          <h3>Current Balance</h3>
          <p>{% if balance %} {{ balance }} {% else %} ... {% endif %}</p>
        </div>

        <div class="card">
          <h3>Top Category</h3>
          <p>
            {% if most_frequent_category %} {{ most_frequent_category }} 
            {% else %} ... {% endif %}
          </p>
        </div>

        <div class="card">
          <h3>Avg Monthly Income</h3>
          <p>{{ avg_income|default:"..." }}</p>
        </div>

        <div class="card">
          <h3>Avg Monthly Expense</h3>
          <p>{{ avg_expense|default:"..." }}</p>
        </div>

        <div class="card">
          <h3>Total Transactions</h3>
          <p>{{ total_transactions|default:"..." }}</p>
        </div>

        <div class="card">
          <h3>Largest Transaction</h3>
          <p>{{ largest_transaction|default:"..." }}</p>
        </div>
      </div>

      <div class="charts">
        <div class="chart-container">
          <canvas id="pieChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="barChart"></canvas>
        </div>
        <div class="chart-container" style="grid-column: span 2">
          <canvas id="lineChart"></canvas>
        </div>

        <div class="chart-container">
          <canvas id="donutChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="radarChart"></canvas>
        </div>
      </div>
    </div>

    <script>

      // Theme toggle
      function toggleTheme() {
        const body = document.body;
        if (body.getAttribute("data-theme") === "light") {
          body.removeAttribute("data-theme");
        } else {
          body.setAttribute("data-theme", "light");
        }
      }

      document.getElementById("fileInput")
      .addEventListener("change", function () {
        console.log("File input changed:", this.files);
        if (this.files.length > 0) {
          console.log("Submitting form...");
          document.getElementById("uploadForm").submit();
        }
      });


      // Charts data

      const pieLabels = {{ pie_labels|default:"[]"|safe }};
      const pieValues = {{ pie_values|default:"[]"|safe }};

      const barLabels = {{ bar_labels|default:"[]"|safe }};
      const barIncome = {{ bar_income|default:"[]"|safe }};
      const barExpense = {{ bar_expense|default:"[]"|safe }};

      const lineLabels = {{ line_labels|default:"[]"|safe }};
      const lineSavings = {{ line_savings|default:"[]"|safe }};

      const donutLabels = {{ donut_labels|default:"[]"|safe }};
      const donutValues = {{ donut_values|default:"[]"|safe }};

      const radarLabels = {{ radar_labels|default:"[]"|safe }};
      const radarValues = {{ radar_values|default:"[]"|safe }};

      const pieCtx = document.getElementById("pieChart").getContext("2d");
      new Chart(pieCtx, {
        type: "pie",
        data: {
          labels: pieLabels,
          datasets: [
            {
              data: pieValues,
              backgroundColor: [
                "#2dd4bf",
                "#60a5fa",
                "#a78bfa",
                "#f472b6",
                "#facc15",
              ],
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
          },
        },
      });

      const barCtx = document.getElementById("barChart").getContext("2d");
      new Chart(barCtx, {
        type: "bar",
        data: {
          labels: barLabels,
          datasets: [
            {
              label: "Income",
              data: barIncome,
              backgroundColor: "#2dd4bf",
            },
            {
              label: "Expenses",
              data: barExpense,
              backgroundColor: "#f472b6",
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
          },
          scales: {
            x: {
              ticks: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
            y: {
              ticks: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
          },
        },
      });

      const lineCtx = document.getElementById("lineChart").getContext("2d");
      new Chart(lineCtx, {
        type: "line",
        data: {
          labels: lineLabels,
          datasets: [
            {
              label: "Savings",
              data: lineSavings,
              borderColor: "#60a5fa",
              backgroundColor: "rgba(96,165,250,0.3)",
              fill: true,
              tension: 0.3,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
          },
          scales: {
            x: {
              ticks: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
            y: {
              ticks: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
          },
        },
      });

      // Donut Chart for Payment Methods
      const donutCtx = document.getElementById("donutChart").getContext("2d");
      new Chart(donutCtx, {
        type: "doughnut",
        data: {
          labels: donutLabels,
          datasets: [
            {
              data: donutValues,
              backgroundColor: ["#2dd4bf", "#facc15", "#a78bfa", "#f472b6"],
            },
          ],
        },
        options: {
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
          },
        },
      });

      // Radar Chart for Spending Habits
      const radarCtx = document.getElementById("radarChart").getContext("2d");
      new Chart(radarCtx, {
        type: "radar",
        data: {
          labels: radarLabels,
          datasets: [
            {
              label: "Spending Profile",
              data: radarValues,
              backgroundColor: "rgba(45,212,191,0.3)",
              borderColor: "#2dd4bf",
              pointBackgroundColor: "#2dd4bf",
            },
          ],
        },
        options: {
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
            },
          },
          scales: {
            r: {
              pointLabels: {
                color: getComputedStyle(document.body).getPropertyValue(
                  "--text"
                ),
              },
              grid: { color: "rgba(255,255,255,0.1)" },
              angleLines: { color: "rgba(255,255,255,0.2)" },
            },
          },
        },
      });
    </script>
  </body>
</html>
